<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BanCuntis - Simulador</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .phone-container {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 40px;
            padding: 8px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .phone-screen {
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 32px;
            overflow: hidden;
            position: relative;
        }
        
        .status-bar {
            height: 44px;
            background: #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            color: white;
            font-size: 14px;
            font-weight: 600;
        }
        
        .app-content {
            height: calc(100% - 44px);
            position: relative;
            overflow: hidden;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            transition: transform 0.3s ease;
            overflow-y: auto;
        }
        
        .screen.hidden {
            transform: translateX(100%);
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 20px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .balance {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .balance h2 {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 8px;
        }
        
        .balance .amount {
            font-size: 36px;
            font-weight: 700;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 20px;
        }
        
        .action-btn {
            background: white;
            border: none;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }
        
        .action-btn .icon {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .action-btn span {
            display: block;
            font-weight: 600;
            color: #333;
        }
        
        .transactions {
            padding: 0 20px 20px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
        }
        
        .transaction-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .transaction-info h4 {
            font-size: 16px;
            margin-bottom: 4px;
            color: #333;
        }
        
        .transaction-info p {
            font-size: 12px;
            color: #666;
        }
        
        .transaction-amount {
            font-weight: 700;
            font-size: 16px;
        }
        
        .transaction-amount.positive {
            color: #10b981;
        }
        
        .transaction-amount.negative {
            color: #ef4444;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
        }
        
        .form-container {
            padding: 30px 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.2s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #2a5298;
        }
        
        .primary-btn {
            width: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }
        
        .primary-btn:hover {
            opacity: 0.9;
        }
        
        .success-message {
            background: #dcfce7;
            color: #166534;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .account-info {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: #666;
            font-size: 14px;
        }
        
        .info-value {
            font-weight: 600;
            color: #333;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        
        .login-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }
        
        .logo-section {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .bank-logo {
            font-size: 64px;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.1);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .logo-section h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .logo-section p {
            opacity: 0.8;
            font-size: 16px;
        }
        
        .login-form {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .login-form .form-group {
            margin-bottom: 25px;
        }
        
        .login-form .form-group label {
            color: white;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
        }
        
        .login-form .form-group input {
            background: rgba(255,255,255,0.9);
            border: 2px solid transparent;
            color: #333;
        }
        
        .login-form .form-group input:focus {
            background: white;
            border-color: #fbbf24;
        }
        
        .login-help {
            margin-top: 30px;
            text-align: center;
            font-size: 12px;
            opacity: 0.8;
        }
        
        .login-help p {
            margin: 5px 0;
        }
        
        .security-note {
            margin-top: 15px;
            color: #10b981;
            font-weight: 600;
        }
        
        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid #fca5a5;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        /* Estilos para 2FA Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 350px;
            text-align: center;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        
        .modal-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }
        
        .modal-subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .sms-code {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            padding: 15px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 3px;
            color: #0369a1;
            margin: 20px 0;
            font-family: monospace;
        }
        
        .code-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            letter-spacing: 2px;
            margin: 15px 0;
            font-family: monospace;
        }
        
        .code-input:focus {
            outline: none;
            border-color: #2a5298;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }
        
        .modal-btn:hover {
            opacity: 0.9;
        }
        
        .modal-btn.cancel {
            background: #f3f4f6;
            color: #374151;
        }
        
        .modal-btn.confirm {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }
        
        .countdown {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
        }
        
        .phone-number {
            color: #2a5298;
            font-weight: 600;
        }
        
        /* Estilos Bizum */
        .bizum-options {
            display: grid;
            gap: 20px;
            padding: 30px 20px;
        }
        
        .bizum-option {
            background: white;
            border: none;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .bizum-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }
        
        .bizum-icon {
            font-size: 36px;
            margin-bottom: 15px;
        }
        
        .bizum-option h3 {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }
        
        .bizum-option p {
            color: #666;
            font-size: 14px;
        }
        
        .bizum-form {
            padding: 30px 20px;
        }
        
        .contact-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .contact-selector input {
            flex: 1;
        }
        
        .contacts-btn {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .contacts-list {
            background: #f8fafc;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #e5e7eb;
        }
        
        .contacts-list h4 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .contact-item:hover {
            background: #e0f2fe;
        }
        
        .contact-item:last-child {
            margin-bottom: 0;
        }
        
        .contact-avatar {
            font-size: 24px;
            margin-right: 12px;
        }
        
        .contact-info {
            flex: 1;
        }
        
        .contact-name {
            display: block;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .contact-phone {
            display: block;
            color: #666;
            font-size: 12px;
        }
        
        .limit-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            display: block;
        }
        
        .secondary-btn {
            width: 100%;
            background: #f3f4f6;
            color: #374151;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .iban-validation {
            font-size: 12px;
            margin-top: 5px;
            padding: 5px 10px;
            border-radius: 6px;
        }
        
        .iban-validation.valid {
            background: #dcfce7;
            color: #166534;
        }
        
        .iban-validation.invalid {
            background: #fee2e2;
            color: #dc2626;
        }
        
        /* Estilos para Tarxetas */
        .cards-container {
            padding: 20px;
        }
        
        .card-item {
            margin-bottom: 25px;
        }
        
        .card-visual {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            position: relative;
            margin-bottom: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .card-visual.credit {
            background: linear-gradient(135deg, #b91c1c 0%, #dc2626 100%);
        }
        
        .card-visual.virtual {
            background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
        }
        
        .card-type {
            font-size: 12px;
            font-weight: 600;
            opacity: 0.8;
            margin-bottom: 20px;
        }
        
        .card-number {
            font-size: 18px;
            font-weight: 700;
            font-family: monospace;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }
        
        .card-holder {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .card-expiry {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .card-status {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .card-status.blocked {
            color: #fca5a5;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        .card-btn {
            flex: 1;
            background: white;
            border: 2px solid #e5e7eb;
            color: #374151;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .card-btn:hover {
            border-color: #2a5298;
            color: #2a5298;
        }
        
        .virtual-cards-section, .cardless-section {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .virtual-cards-section h3, .cardless-section h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
        }
        
        .virtual-card-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #8b5cf6;
        }
        
        .virtual-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .virtual-card-name {
            font-weight: 600;
            color: #333;
        }
        
        .virtual-card-balance {
            font-size: 18px;
            font-weight: 700;
            color: #8b5cf6;
        }
        
        .virtual-card-details {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .virtual-card-actions {
            display: flex;
            gap: 8px;
        }
        
        .virtual-card-btn {
            background: #f3f4f6;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            color: #374151;
        }
        
        .virtual-card-btn:hover {
            background: #e5e7eb;
        }
        
        .cardless-code {
            background: #0ea5e9;
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 15px 0;
        }
        
        .cardless-code h4 {
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .cardless-code-number {
            font-size: 28px;
            font-weight: 700;
            font-family: monospace;
            letter-spacing: 3px;
        }
        
        .cardless-expires {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 10px;
        }
        
        /* Estilos para Gestión de Tarxetas */
        .management-container {
            padding: 20px;
        }
        
        .management-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .management-section h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
        }
        
        .limit-item {
            margin-bottom: 20px;
        }
        
        .limit-item label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .limit-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .limit-controls input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .limit-max {
            color: #666;
            font-size: 14px;
            font-weight: 600;
        }
        
        .operation-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .operation-toggle:last-child {
            border-bottom: none;
        }
        
        .operation-toggle label {
            font-weight: 600;
            color: #333;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #e5e7eb;
            transition: 0.3s;
            border-radius: 25px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 19px;
            width: 19px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #10b981;
        }
        
        input:focus + .slider {
            box-shadow: 0 0 1px #10b981;
        }
        
        input:checked + .slider:before {
            transform: translateX(25px);
        }
        
        .operation-toggle label {
            font-weight: 600;
            color: #333;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="phone-screen">
            <div class="status-bar">
                <span id="current-time">9:41</span>
                <span>BanCuntis</span>
                <span>100%</span>
            </div>
            
            <div class="app-content">
                <!-- Pantalla de Login -->
                <div class="screen" id="login">
                    <div class="login-container">
                        <div class="logo-section">
                            <div class="bank-logo">🏦</div>
                            <h1>BanCuntis</h1>
                            <p>Banca segura e confiable dende Cuntis</p>
                        </div>
                        
                        <div class="login-form">
                            <div id="login-error" class="error-message" style="display: none;">
                                Conta Usuaria ou contrasinal incorrectas
                            </div>
                            
                            <div class="form-group">
                                <label>Usuaria</label>
                                <input type="text" id="username" placeholder="Introduce conta usuaria" value="aitor.tilla">
                            </div>
                            
                            <div class="form-group">
                                <label>Contrasinal</label>
                                <input type="password" id="password" placeholder="••••••••">
                            </div>
                            
                            <button class="primary-btn" onclick="attemptLogin()">
                                Iniciar Sesión
                            </button>
                            
                            <div class="login-help">
                                <p><strong>Usuaria de proba:</strong> aitor.tilla</p>
                                <p><strong>Contrasinal:</strong> Cuntis123</p>
                                <p class="security-note">🔒 Conexión CeMIT segura SSL</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Pantalla Principal -->
                <div class="screen hidden" id="home">
                    <div class="header">
                        <button class="back-btn" onclick="logout()" style="right: 20px; left: auto;">🚪</button>
                        <h1 id="welcome-message">¡Hola, María!</h1>
                        <p>Dámosche a Benvida ao teu Banco Cuntiense Dixital</p>
                    </div>
                    
                    <div class="balance">
                        <h2>Saldo dispoñíbel</h2>
                        <div class="amount" id="balance">€2,540.75</div>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="action-btn" onclick="showScreen('transfer')">
                            <div class="icon">💸</div>
                            <span>Transferir</span>
                        </button>
                        <button class="action-btn" onclick="showScreen('bizum')">
                            <div class="icon">📱</div>
                            <span>Bizum</span>
                        </button>
                        <button class="action-btn" onclick="showScreen('pay')">
                            <div class="icon">💳</div>
                            <span>Pagar Recibos</span>
                        </button>
                        <button class="action-btn" onclick="showScreen('deposit')">
                            <div class="icon">💰</div>
                            <span>Ingresar</span>
                        </button>
                        <button class="action-btn" onclick="showScreen('account')">
                            <div class="icon">👤</div>
                            <span>A Miña Conta</span>
                        </button>
                        <button class="action-btn" onclick="showScreen('cards')">
                            <div class="icon">💳</div>
                            <span>As Miñas Tarxetas</span>
                        </button>
                    </div>
                    
                    <div class="transactions">
                        <h3 class="section-title">Últimos movementos</h3>
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <h4>Supermercado Ameixeiras</h4>
                                <p>Hoy, 14:30</p>
                            </div>
                            <div class="transaction-amount negative">-€45.20</div>
                        </div>
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <h4>Nómina - Concello Cuntis</h4>
                                <p>Ayer, 08:00</p>
                            </div>
                            <div class="transaction-amount positive">+€800.00</div>
                        </div>
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <h4>Termas de Cuntis</h4>
                                <p>25 Ago, 10:15</p>
                            </div>
                            <div class="transaction-amount negative">-€15.99</div>
                        </div>
                    </div>
                </div>
                
                <!-- Pantalla Transferir -->
                <div class="screen hidden" id="transfer">
                    <div class="header">
                        <button class="back-btn" onclick="showScreen('home')">←</button>
                        <h1>Transferir Diñeiro</h1>
                    </div>
                    
                    <div class="form-container">
                        <div id="transfer-success" class="success-message" style="display: none;">
                            ¡Transferencia realizada con éxito!
                        </div>
                        
                        <div class="form-group">
                            <label>Destinataria</label>
                            <input type="text" id="recipient" placeholder="Nombre del destinatario">
                        </div>
                        
                        <div class="form-group">
                            <label>Número de conta (IBAN)</label>
                            <label><i>por exemplo: ES44 3070 0418 9002 0080 2014</i></label>
                            <input type="text" id="account-number" placeholder="ES00 0000 0000 0000 0000 0000" maxlength="29">
                            <div class="iban-validation" id="iban-validation" style="display: none;"></div>
                        </div>
                        
                        <div class="form-group">
                            <label>Cantidad</label>
                            <input type="number" id="amount" placeholder="0.00" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label>Conta de orixe</label>
                            <select id="origin-account">
                                <option value="checking">Conta Corrente (€2,540.75)</option>
                                <option value="debit">Tarxeta Débito (dispoñíbel)</option>
                                <option value="credit">Tarxeta Crédito (dispoñíbel)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Tipo de transferencia</label>
                            <select id="transfer-type" onchange="toggleTransferOptions()">
                                <option value="immediate">Inmediata</option>
                                <option value="scheduled">Programada</option>
                                <option value="recurring">Periódica</option>
                            </select>
                        </div>
                        
                        <div id="scheduled-options" style="display: none;">
                            <div class="form-group">
                                <label>Data de execución</label>
                                <input type="date" id="execution-date">
                            </div>
                        </div>
                        
                        <div id="recurring-options" style="display: none;">
                            <div class="form-group">
                                <label>Frecuencia</label>
                                <select id="recurring-frequency">
                                    <option value="weekly">Semanal</option>
                                    <option value="biweekly">Quincenal</option>
                                    <option value="monthly">Mensual</option>
                                    <option value="quarterly">Trimestral</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Data de inicio</label>
                                <input type="date" id="recurring-start-date">
                            </div>
                            <div class="form-group">
                                <label>Data de fin (opcional)</label>
                                <input type="date" id="recurring-end-date">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Concepto</label>
                            <input type="text" id="concept" placeholder="Concepto de la transferencia">
                        </div>
                        
                        <button class="primary-btn" onclick="processTransfer()">
                            <span id="transfer-btn-text">Enviar Transferencia</span>
                        </button>
                    </div>
                </div>
                
                <!-- Pantalla Bizum -->
                <div class="screen hidden" id="bizum">
                    <div class="header">
                        <button class="back-btn" onclick="showScreen('home')">←</button>
                        <h1>💰 Bizum</h1>
                        <p>Pagos instantáneos</p>
                    </div>
                    
                    <div class="bizum-options">
                        <button class="bizum-option" onclick="showBizumAction('send')">
                            <div class="bizum-icon">📤</div>
                            <h3>Enviar Diñeiro</h3>
                            <p>Pagar a un contacto</p>
                        </button>
                        
                        <button class="bizum-option" onclick="showBizumAction('request')">
                            <div class="bizum-icon">📥</div>
                            <h3>Solicitar Diñeiro</h3>
                            <p>Pedir diñeiro a un contacto</p>
                        </button>
                    </div>
                    
                    <div class="bizum-form" id="bizum-form" style="display: none;">
                        <div id="bizum-success" class="success-message" style="display: none;">
                            ¡Operación Bizum realizada con éxito!
                        </div>
                        
                        <div class="form-group">
                            <label id="bizum-action-label">Enviar diñeiro a:</label>
                            <div class="contact-selector">
                                <input type="tel" id="phone-number" placeholder="+34 600 000 000" maxlength="15">
                                <button type="button" class="contacts-btn" onclick="showContacts()">📋</button>
                            </div>
                        </div>
                        
                        <div class="contacts-list" id="contacts-list" style="display: none;">
                            <h4>Contactos frecuentes</h4>
                            <div class="contact-item" onclick="selectContact('Antonio Lois', '+34 655 123 986')">
                                <div class="contact-avatar">👱‍♀️</div>
                                <div class="contact-info">
                                    <span class="contact-name">Antonio Lois</span>
                                    <span class="contact-phone">+34 655 123 986</span>
                                </div>
                            </div>
                            <div class="contact-item" onclick="selectContact('Cástor Notario', '+34 655 123 789')">
                                <div class="contact-avatar">👱‍♀️</div>
                                <div class="contact-info">
                                    <span class="contact-name">Cástor Notario</span>
                                    <span class="contact-phone">+34 655 123 789</span>
                                </div>
                            </div>
                            <div class="contact-item" onclick="selectContact('Chairo - José Antonio', '+34 655 123 111')">
                                <div class="contact-avatar">👱‍♀️</div>
                                <div class="contact-info">
                                    <span class="contact-name">Chairo - José Antonio</span>
                                    <span class="contact-phone">+34 655 123 111</span>
                                </div>
                            </div>
                            <div class="contact-item" onclick="selectContact('Germán', '+34 698 765 222')">
                                <div class="contact-avatar">👨</div>
                                <div class="contact-info">
                                    <span class="contact-name">Germán</span>
                                    <span class="contact-phone">+34 698 765 222</span>
                                </div>
                            </div>
                            <div class="contact-item" onclick="selectContact('Joaquín Palmás', '+34 698 765 333')">
                                <div class="contact-avatar">👨</div>
                                <div class="contact-info">
                                    <span class="contact-name">Joaquín Palmás</span>
                                    <span class="contact-phone">+34 698 765 333</span>
                                </div>
                            </div>
                            <div class="contact-item" onclick="selectContact('Lupe Caldas', '+34 612 345 444')">
                                <div class="contact-avatar">👩</div>
                                <div class="contact-info">
                                    <span class="contact-name">Lupe Caldas</span>
                                    <span class="contact-phone">+34 612 345 444</span>
                                </div>
                            </div>
                                                       
                            <div class="contact-item" onclick="selectContact('Ximénez', '+34 687 654 555')">
                                <div class="contact-avatar">🧔</div>
                                <div class="contact-info">
                                    <span class="contact-name">Ximénez</span>
                                    <span class="contact-phone">+34 687 654 555</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Cantidade (€)</label>
                            <input type="number" id="bizum-amount" placeholder="0.00" step="0.01" max="500">
                            <small class="limit-text">Límite: 500€ por operación. Non somos políticos</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Conta de orixe</label>
                            <select id="bizum-origin-account">
                                <option value="checking">Conta Corrente (€2,540.75)</option>
                                <option value="debit">Tarxeta Débito (dispoñíbel)</option>
                                <option value="credit">Tarxeta Crédito (dispoñíbel)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Concepto (opcional)</label>
                            <input type="text" id="bizum-concept" placeholder="Cea, regalo, viño no furancho, etc." maxlength="50">
                        </div>
                        
                        <button class="primary-btn" id="bizum-submit-btn" onclick="processBizum()">
                            Enviar Bizum
                        </button>
                        
                        <button class="secondary-btn" onclick="cancelBizum()">
                            Cancelar
                        </button>
                    </div>
                </div>
                
                <!-- Pantalla Pagar Recibos -->
                <div class="screen hidden" id="pay">
                    <div class="header">
                        <button class="back-btn" onclick="showScreen('home')">←</button>
                        <h1>Pagar Recibos</h1>
                    </div>
                    
                    <div class="form-container">
                        <div id="pay-success" class="success-message" style="display: none;">
                            ¡Pago realizado correctamente!
                        </div>
                        
                        <div class="form-group">
                            <label>Tipo de pago</label>
                            <select id="payment-type">
                                <option>Recibo de luz ElectraCuntiense</option>
                                <option>Recibo de auga</option>
                                <option>Seguro do coche</option>
                                <option>Hipoteca</option>
                                <option>Outro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Referencia</label>
                            <input type="text" id="reference" placeholder="Número de referencia">
                        </div>
                        
                        <div class="form-group">
                            <label>Importe</label>
                            <input type="number" id="pay-amount" placeholder="0.00" step="0.01">
                        </div>
                        
                        <button class="primary-btn" onclick="processPayment()">
                            Realizar Pago
                        </button>
                    </div>
                </div>
                
                <!-- Pantalla Ingresar -->
                <div class="screen hidden" id="deposit">
                    <div class="header">
                        <button class="back-btn" onclick="showScreen('home')">←</button>
                        <h1>Ingresar Diñeiro</h1>
                    </div>
                    
                    <div class="form-container">
                        <div id="deposit-success" class="success-message" style="display: none;">
                            ¡Ingreso realizado con éxito!
                        </div>
                        
                        <div class="form-group">
                            <label>Tipo de ingreso</label>
                            <select id="deposit-type">
                                <option>Transferencia dende outra conta</option>
                                <option>Ingreso en efectivo</option>
                                <option>Cheque</option>
                                <option>Devolución</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Cantidade</label>
                            <input type="number" id="deposit-amount" placeholder="0.00" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label>Descrición</label>
                            <input type="text" id="deposit-desc" placeholder="Descripción del ingreso">
                        </div>
                        
                        <button class="primary-btn" onclick="processDeposit()">
                            Confirmar Ingreso
                        </button>
                    </div>
                </div>
                
                <!-- Pantalla Mi Cuenta -->
                <div class="screen hidden" id="account">
                    <div class="header">
                        <button class="back-btn" onclick="showScreen('home')">←</button>
                        <h1>A Miña Conta</h1>
                    </div>
                    
                    <div class="account-info">
                        <div class="info-row">
                            <span class="info-label">Titular</span>
                            <span class="info-value">Aitor Tilla</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Número de conta</span>
                            <span class="info-value">ES91 2100 0418 4502 0005 1332</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">IBAN</span>
                            <span class="info-value">ES91 2100 0418 4502 0005 1332</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">BIC/SWIFT</span>
                            <span class="info-value">CUNTISBBXXX</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Tipo de conta</span>
                            <span class="info-value">Conta Corriente</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Estado</span>
                            <span class="info-value">Activa</span>
                        </div>
                    </div>
                    
                    <div style="padding: 20px;">
                        <button class="primary-btn" onclick="downloadStatement()">
                            Descargar Extracto
                        </button>
                    </div>
                </div>
                
                <!-- Pantalla Mis Tarxetas -->
                <div class="screen hidden" id="cards">
                    <div class="header">
                        <button class="back-btn" onclick="showScreen('home')">←</button>
                        <h1>💳 As Miñas Tarxetas</h1>
                    </div>
                    
                    <div class="cards-container">
                        <!-- Tarxeta Débito -->
                        <div class="card-item">
                            <div class="card-visual debit">
                                <div class="card-type">DÉBITO</div>
                                <div class="card-number">•••• •••• •••• 1332</div>
                                <div class="card-holder">AITOR TILLA</div>
                                <div class="card-expiry">12/28</div>
                                <div class="card-status active" id="debit-status">🟢 ACTIVA</div>
                            </div>
                            <div class="card-actions">
                                <button class="card-btn" onclick="toggleCardStatus('debit')">
                                    <span id="debit-toggle-text">🔒 Bloquear</span>
                                </button>
                                <button class="card-btn" onclick="showCardManagement('debit')">
                                    ⚙️ Xestionar
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tarxeta Crédito -->
                        <div class="card-item">
                            <div class="card-visual credit">
                                <div class="card-type">CRÉDITO</div>
                                <div class="card-number">•••• •••• •••• 7890</div>
                                <div class="card-holder">CHAPANTE</div>
                                <div class="card-expiry">06/27</div>
                                <div class="card-status active" id="credit-status">🟢 ACTIVA</div>
                            </div>
                            <div class="card-actions">
                                <button class="card-btn" onclick="toggleCardStatus('credit')">
                                    <span id="credit-toggle-text">🔒 Bloquear</span>
                                </button>
                                <button class="card-btn" onclick="showCardManagement('credit')">
                                    ⚙️ xestionar
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tarxetas Virtuales -->
                        <div class="virtual-cards-section">
                            <h3>Tarxetas Virtuais</h3>
                            <div id="virtual-cards-list">
                                <!-- Las tarxetas virtuales se añadirán dinámicamente -->
                            </div>
                            <button class="primary-btn" onclick="showCreateVirtualCard()">
                                + Crear Tarxeta Virtual
                            </button>
                        </div>
                        
                        <!-- Retirada sin tarxeta -->
                        <div class="cardless-section">
                            <h3>Retirada Sen Tarxeta</h3>
                            <p>Xerar un código para retirar efectivo sen tarxeta física</p>
                            <button class="primary-btn" onclick="generateCardlessCode()">
                                📱 Xerar Código
                            </button>
                            <div id="cardless-code-display" style="display: none;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Pantalla Gestión de Tarxeta -->
                <div class="screen hidden" id="card-management">
                    <div class="header">
                        <button class="back-btn" onclick="showScreen('cards')">←</button>
                        <h1 id="management-title">Xestionar Tarxeta</h1>
                    </div>
                    
                    <div class="management-container">
                        <!-- Límites -->
                        <div class="management-section">
                            <h3>💰 Límites de Tarxeta</h3>
                            <div class="limit-item">
                                <label>Compras diarias (€)</label>
                                <div class="limit-controls">
                                    <input type="number" id="daily-purchases-limit" value="1500" max="3000" min="0">
                                    <span class="limit-max">/ 3.000€</span>
                                </div>
                            </div>
                            <div class="limit-item">
                                <label>Retiradas Caixeiros diarias (€)</label>
                                <div class="limit-controls">
                                    <input type="number" id="daily-atm-limit" value="600" max="1000" min="0">
                                    <span class="limit-max">/ 1.000€</span>
                                </div>
                            </div>
                            <div class="limit-item">
                                <label>Compras online mensuais (€)</label>
                                <div class="limit-controls">
                                    <input type="number" id="monthly-online-limit" value="2000" max="5000" min="0">
                                    <span class="limit-max">/ 5.000€</span>
                                </div>
                            </div>
                            <button class="primary-btn" onclick="updateLimits()">Actualizar Límites</button>
                        </div>
                        
                        <!-- Controles de Operaciones -->
                        <div class="management-section">
                            <h3>🌍 Control de Operacións</h3>
                            <div class="operation-toggle">
                                <label>Compras en liña</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="online-purchases" checked>
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <div class="operation-toggle">
                                <label>Compras no extranxeiro</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="foreign-purchases" checked>
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <div class="operation-toggle">
                                <label>Retiradas Caixeiros extranxeiro</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="foreign-atm">
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <div class="operation-toggle">
                                <label>Pagos contactless</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="contactless-payments" checked>
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <div class="operation-toggle">
                                <label>Sacar diñeiro en comercios</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="cashback-purchases" checked>
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <div class="operation-toggle">
                                <label>Devolver pagos</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="payment-returns" checked>
                                    <span class="slider"></span>
                                </div>
                            </div>
                            <button class="primary-btn" onclick="updateOperationSettings()">Gardar Configuración</button>
                        </div>
                    </div>
                </div>
                
                <!-- Pantalla Crear Tarxeta Virtual -->
                <div class="screen hidden" id="create-virtual-card">
                    <div class="header">
                        <button class="back-btn" onclick="showScreen('cards')">←</button>
                        <h1>🆕 Nova Tarxeta Virtual</h1>
                    </div>
                    
                    <div class="form-container">
                        <div class="form-group">
                            <label>Nome da tarxeta</label>
                            <input type="text" id="virtual-card-name" placeholder="Ej: Compras Ameixeiras, Pernas, Mieres, etc.">
                        </div>
                        
                        <div class="form-group">
                            <label>Límite de gasto (€)</label>
                            <input type="number" id="virtual-card-limit" placeholder="100" max="1000" min="10" step="10">
                            <small class="limit-text">Máximo: 1.000€</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Válida ata</label>
                            <select id="virtual-card-validity">
                                <option value="24">24 horas</option>
                                <option value="168">1 semana</option>
                                <option value="720" selected>1 mes</option>
                                <option value="2160">3 meses</option>
                                <option value="8760">1 ano</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Tipo de uso</label>
                            <select id="virtual-card-type">
                                <option value="online">Só compras online</option>
                                <option value="subscription">Suscricións recurrentes</option>
                                <option value="general">Uso xeral</option>
                            </select>
                        </div>
                        
                        <button class="primary-btn" onclick="createVirtualCard(); return false;">Crear Tarxeta Virtual</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de 2FA -->
    <div class="modal-overlay" id="twofa-modal">
        <div class="modal-content">
            <div class="modal-icon">📱</div>
            <div class="modal-title">Código de Verificación SIMULADO</div>
            <div class="modal-subtitle">
                Enviado un código SMS SIMULADO ao número<br>
                <span class="phone-number">*****1234</span>
            </div>
            
            <div class="sms-code" id="generated-code">123456</div>
            
            <input type="text" class="code-input" id="code-input" placeholder="Introduce el código" maxlength="6">
            
            <div class="countdown" id="countdown">Código válido por: <span id="timer">60</span>s</div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="cancel2FA()">Cancelar</button>
                <button class="modal-btn confirm" onclick="verify2FA()">Verificar</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentBalance = 2540.75;
        let current2FACode = '';
        let pending2FAAction = null;
        let pending2FAData = null;
        let countdownTimer = null;
        let timeLeft = 60;
        let currentBizumAction = '';
        let virtualCards = [];
        let cardStatuses = {
            debit: 'active',
            credit: 'active'
        };
        let currentUser = '';
        
        // Lista de nombres aleatorios
        const randomNames = ['Antonio', 'Cástor', 'Chairo','Joaquín', 'Germán', 'Ximenez', 'Lupe', 'Víctor'];
        
        // Función para validar IBAN
        function validateIBAN(iban) {
            iban = iban.replace(/\s/g, '').toUpperCase();
            if (iban.length !== 24) return false;
            if (!iban.match(/^ES[0-9A-Z]{22}$/)) return false;
            
            const rearranged = iban.substring(4) + iban.substring(0, 4);
            let numericString = '';
            
            for (let char of rearranged) {
                if (char >= '0' && char <= '9') {
                    numericString += char;
                } else {
                    numericString += (char.charCodeAt(0) - 55).toString();
                }
            }
            
            let remainder = 0;
            for (let i = 0; i < numericString.length; i++) {
                remainder = (remainder * 10 + parseInt(numericString[i])) % 97;
            }
            
            return remainder === 1;
        }
        
        // Función para formatear IBAN mientras se escribe
        function formatIBAN(input) {
            let value = input.replace(/\s/g, '').toUpperCase();
            let formatted = '';
            
            for (let i = 0; i < value.length; i++) {
                if (i > 0 && i % 4 === 0) {
                    formatted += ' ';
                }
                formatted += value[i];
            }
            
            return formatted;
        }
        
        // **NUEVAS FUNCIONES FALTANTES**
        
        // Función para alternar estado de tarxeta
        function toggleCardStatus(cardType) {
            const status = cardStatuses[cardType];
            const statusElement = document.getElementById(cardType + '-status');
            const toggleElement = document.getElementById(cardType + '-toggle-text');
            
            if (status === 'active') {
                cardStatuses[cardType] = 'blocked';
                statusElement.textContent = '🔴 BLOQUEADA';
                statusElement.className = 'card-status blocked';
                toggleElement.textContent = '🔓 Desbloquear';
                alert(`Tarxeta de ${cardType === 'debit' ? 'débito' : 'crédito'} bloqueada correctamente`);
            } else {
                cardStatuses[cardType] = 'active';
                statusElement.textContent = '🟢 ACTIVA';
                statusElement.className = 'card-status active';
                toggleElement.textContent = '🔒 Bloquear';
                alert(`Tarxeta de ${cardType === 'debit' ? 'débito' : 'crédito'} desbloqueada correctamente`);
            }
        }
        
        // Función para mostrar gestión de tarxeta
        function showCardManagement(cardType) {
            const title = document.getElementById('management-title');
            title.textContent = `Xestionar Tarxeta ${cardType === 'debit' ? 'de Débito' : 'de Crédito'}`;
            showScreen('card-management');
        }
        
        // Función para mostrar crear tarxeta virtual
        function showCreateVirtualCard() {
            console.log('Navegando a crear tarxeta virtual'); // Debug
            showScreen('create-virtual-card');
        }
        
        // Función para crear tarxeta virtual
        function createVirtualCard() {
            try {
                console.log('=== INICIO createVirtualCard ===');
                
                const nameElement = document.getElementById('virtual-card-name');
                const limitElement = document.getElementById('virtual-card-limit');
                const validityElement = document.getElementById('virtual-card-validity');
                const typeElement = document.getElementById('virtual-card-type');
                
                console.log('Elementos encontrados:', {
                    name: nameElement ? 'SI' : 'NO',
                    limit: limitElement ? 'SI' : 'NO',
                    validity: validityElement ? 'SI' : 'NO',
                    type: typeElement ? 'SI' : 'NO'
                });
                
                const name = nameElement ? nameElement.value.trim() : '';
                const limit = limitElement ? parseFloat(limitElement.value) : 0;
                const validity = validityElement ? parseInt(validityElement.value) : 720;
                const type = typeElement ? typeElement.value : 'online';
                
                console.log('Valores obtidos:', { name, limit, validity, type });
                
                if (!name) {
                    alert('Por favor, introduce un nome para a tarxeta');
                    console.log('Error: nome valeiro');
                    return false;
                }
                
                if (!limit || isNaN(limit) || limit < 10 || limit > 1000) {
                    alert('O límite debe estar entre 10€ e 1.000€. Non somos políticos');
                    console.log('Error: límite inválido:', limit);
                    return false;
                }
                
                console.log('Validacións pasadas, creando tarxeta...');
                
                // Generar número de tarxeta virtual
                const cardNumber = '5555 ' + Math.floor(1000 + Math.random() * 9000) + ' ' + 
                                 Math.floor(1000 + Math.random() * 9000) + ' ' + 
                                 Math.floor(1000 + Math.random() * 9000);
                
                const expiryDate = new Date();
                expiryDate.setHours(expiryDate.getHours() + validity);
                
                const virtualCard = {
                    id: Date.now(),
                    name: name,
                    number: cardNumber,
                    limit: limit,
                    balance: limit,
                    expiry: expiryDate,
                    type: type,
                    cvv: Math.floor(100 + Math.random() * 900)
                };
                
                console.log('Tarxeta creada:', virtualCard);
                
                virtualCards.push(virtualCard);
                console.log('Total tarxetas virtuais:', virtualCards.length);
                
                updateVirtualCardsList();
                console.log('Lista actualizada');
                
                // Limpiar formulario
                if (nameElement) nameElement.value = '';
                if (limitElement) limitElement.value = '';
                if (validityElement) validityElement.selectedIndex = 2;
                if (typeElement) typeElement.selectedIndex = 0;
                console.log('Formulario limpo');
                
                alert('¡Tarxeta virtual creada correctamente!\n\nNombre: ' + name + '\nLímite: €' + limit);
                console.log('Amosando alerta e navegando...');
                
                showScreen('cards');
                console.log('=== FIN createVirtualCard ===');
                
                return false;
                
            } catch (error) {
                console.error('Erro en createVirtualCard:', error);
                alert('Erro ao crear a tarxeta virtual: ' + error.message);
                return false;
            }
        }
        
        // Función para actualizar lista de tarxetas virtuales
        function updateVirtualCardsList() {
            const container = document.getElementById('virtual-cards-list');
            container.innerHTML = '';
            
            virtualCards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'virtual-card-item';
                
                const now = new Date();
                const isExpired = now > card.expiry;
                
                cardElement.innerHTML = `
                    <div class="virtual-card-header">
                        <span class="virtual-card-name">${card.name}</span>
                        <span class="virtual-card-balance">€${card.balance.toFixed(2)}</span>
                    </div>
                    <div class="virtual-card-details">
                        Número: ${card.number}<br>
                        CVV: ${card.cvv} | Caduca: ${card.expiry.toLocaleDateString()}<br>
                        Estado: ${isExpired ? '🔴 Expirada' : '🟢 Activa'}
                    </div>
                    <div class="virtual-card-actions">
                        <button class="virtual-card-btn" onclick="copyCardNumber('${card.number}')">Copiar Número</button>
                        <button class="virtual-card-btn" onclick="deleteVirtualCard(${card.id})">Eliminar</button>
                    </div>
                `;
                
                container.appendChild(cardElement);
            });
        }
        
        // Función para eliminar tarxeta virtual 
        function deleteVirtualCard(cardId) {
            console.log('Intentando eliminar tarxeta con ID:', cardId);
            if (confirm('¿Estás seguro de que queres eliminar esta tarxeta virtual?')) {
                const initialLength = virtualCards.length;
                virtualCards = virtualCards.filter(card => card.id !== cardId);
                console.log('Tarxetas antes:', initialLength, 'despois:', virtualCards.length);
                
                if (virtualCards.length < initialLength) {
                    updateVirtualCardsList();
                    alert('Tarxeta virtual eliminada correctamente');
                } else {
                    alert('Erro ao eliminar a tarxeta');
                }
            }
        }
        
        // Función para generar código sin tarxeta
        function generateCardlessCode() {
            const code = Math.floor(100000 + Math.random() * 900000);
            const expiryTime = new Date();
            expiryTime.setMinutes(expiryTime.getMinutes() + 15);
            
            const codeDisplay = document.getElementById('cardless-code-display');
            codeDisplay.innerHTML = `
                <div class="cardless-code">
                    <h4>Código de Retirada</h4>
                    <div class="cardless-code-number">${code}</div>
                    <div class="cardless-expires">Válido hasta: ${expiryTime.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}</div>
                </div>
            `;
            codeDisplay.style.display = 'block';
            
            // Ocultar código después de 15 minutos
            setTimeout(() => {
                codeDisplay.style.display = 'none';
            }, 900000); // 15 minutos
        }
        
        // Función para actualizar límites
        function updateLimits() {
            const dailyPurchases = parseInt(document.getElementById('daily-purchases-limit').value);
            const dailyATM = parseInt(document.getElementById('daily-atm-limit').value);
            const monthlyOnline = parseInt(document.getElementById('monthly-online-limit').value);
            
            // Validaciones
            if (dailyPurchases < 0 || dailyPurchases > 3000) {
                alert('O límite de compras diarias debe estar entre 0€ e 3.000€');
                return;
            }
            
            if (dailyATM < 0 || dailyATM > 1000) {
                alert('O límite de retiradas ATM debe estar entre 0€ e 1.000€');
                return;
            }
            
            if (monthlyOnline < 0 || monthlyOnline > 5000) {
                alert('O límite de compras online debe estar entre 0€ e 5.000€');
                return;
            }
            
            // Simular guardado con efecto visual
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Gardando...';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = '✓ Límites Actualizados';
                button.style.background = '#10b981';
                
                setTimeout(() => {
                    alert('Límites actualizados correctamente');
                    
                    // Regresar a la pantalla de tarxetas automáticamente
                    setTimeout(() => {
                        showScreen('cards');
                    }, 1000);
                    
                }, 2000);
            }, 1000);
            
            // Guardar en variables locales (simulación)
            console.log('Límites gardados:', { dailyPurchases, dailyATM, monthlyOnline });
        }
        
        // Función para actualizar configuración de operaciones
        function updateOperationSettings() {
            const settings = {
                onlinePurchases: document.getElementById('online-purchases').checked,
                foreignPurchases: document.getElementById('foreign-purchases').checked,
                foreignATM: document.getElementById('foreign-atm').checked,
                contactlessPayments: document.getElementById('contactless-payments').checked,
                cashbackPurchases: document.getElementById('cashback-purchases').checked,
                paymentReturns: document.getElementById('payment-returns').checked
            };
            
            // Simular guardado con efecto visual
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Gardando...';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = '✓ Configuración Guardada';
                button.style.background = '#10b981';
                
                setTimeout(() => {
                    // Mostrar feedback específico basado en los cambios
                    let feedbackMessages = [];
                    if (!settings.onlinePurchases) feedbackMessages.push('Compras online desactivadas');
                    if (!settings.foreignPurchases) feedbackMessages.push('Compras no extranxeiro desactivadas');
                    if (!settings.foreignATM) feedbackMessages.push('Retiradas ATM extranxeiro desactivadas');
                    if (!settings.contactlessPayments) feedbackMessages.push('Pagos contactless desactivados');
                    if (!settings.cashbackPurchases) feedbackMessages.push('Sacar diñeiro en comercios desactivado');
                    if (!settings.paymentReturns) feedbackMessages.push('Devolver pagos desactivado');
                    
                    if (feedbackMessages.length > 0) {
                        alert('Configuración actualizada:\n• ' + feedbackMessages.join('\n• '));
                    } else {
                        alert('Todas as operacións están activadas');
                    }
                    
                    // Regresar a la pantalla de tarxetas automáticamente
                    setTimeout(() => {
                        showScreen('cards');
                    }, 1000);
                    
                }, 2000);
            }, 1000);
            
            // Guardar configuración (simulación)
            console.log('Configuración gardada:', settings);
        }
        
        // Mejorar la funcionalidad de los toggles
        function setupToggleSwitches() {
            // Agregar event listeners para todos los checkboxes de toggle
            const toggleInputs = document.querySelectorAll('.toggle-switch input[type="checkbox"]');
            
            toggleInputs.forEach(input => {
                // Asegurar que el evento click funcione correctamente
                input.addEventListener('click', function(e) {
                    e.stopPropagation();
                    console.log(`Toggle ${this.id} changed to: ${this.checked}`);
                    
                    // Efecto visual
                    const slider = this.nextElementSibling;
                    slider.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        slider.style.transform = 'scale(1)';
                    }, 150);
                });
                
                // También permitir cambio con la barra espaciadora
                input.addEventListener('keydown', function(e) {
                    if (e.key === ' ') {
                        e.preventDefault();
                        this.checked = !this.checked;
                        this.dispatchEvent(new Event('click'));
                    }
                });
            });
        }
        
        // Validación en tiempo real de IBAN
        document.addEventListener('input', function(e) {
            if (e.target.id === 'account-number') {
                const input = e.target;
                const validation = document.getElementById('iban-validation');
                
                // Formatear IBAN
                input.value = formatIBAN(input.value);
                
                // Validar IBAN
                const cleanIBAN = input.value.replace(/\s/g, '');
                
                if (cleanIBAN.length === 0) {
                    validation.style.display = 'none';
                } else if (cleanIBAN.length < 24) {
                    validation.style.display = 'block';
                    validation.className = 'iban-validation invalid';
                    validation.textContent = 'IBAN incompleto';
                } else if (validateIBAN(cleanIBAN)) {
                    validation.style.display = 'block';
                    validation.className = 'iban-validation valid';
                    validation.textContent = '✓ IBAN válido';
                } else {
                    validation.style.display = 'block';
                    validation.className = 'iban-validation invalid';
                    validation.textContent = '✗ IBAN inválido';
                }
            }
            
            // Validación para campos numéricos
            if (e.target.type === 'number') {
                if (e.target.value < 0) {
                    e.target.value = '';
                }
            }
        });
        
        // Funciones Bizum
        function showBizumAction(action) {
            currentBizumAction = action;
            const form = document.getElementById('bizum-form');
            const label = document.getElementById('bizum-action-label');
            const submitBtn = document.getElementById('bizum-submit-btn');
            
            if (action === 'send') {
                label.textContent = 'Enviar diñeiro a:';
                submitBtn.textContent = 'Enviar Bizum';
            } else {
                label.textContent = 'Solicitar diñeiro a:';
                submitBtn.textContent = 'Solicitar Bizum';
            }
            
            form.style.display = 'block';
            document.querySelector('.bizum-options').style.display = 'none';
        }
        
        function showContacts() {
            const contactsList = document.getElementById('contacts-list');
            contactsList.style.display = contactsList.style.display === 'none' ? 'block' : 'none';
        }
        
        function selectContact(name, phone) {
            document.getElementById('phone-number').value = phone;
            document.getElementById('contacts-list').style.display = 'none';
        }
        
        function cancelBizum() {
            document.getElementById('bizum-form').style.display = 'none';
            document.querySelector('.bizum-options').style.display = 'grid';
            
            // Limpiar formulario
            document.getElementById('phone-number').value = '';
            document.getElementById('bizum-amount').value = '';
            document.getElementById('bizum-concept').value = '';
            document.getElementById('contacts-list').style.display = 'none';
        }
        
        function processBizum() {
            const phone = document.getElementById('phone-number').value;
            const amount = parseFloat(document.getElementById('bizum-amount').value);
            const concept = document.getElementById('bizum-concept').value || 'Pago Bizum';
            
            if (!phone || !phone.match(/^\+?[0-9\s]{9,15}$/)) {
                alert('Por favor, introduce un número de teléfono válido.');
                return;
            }
            
            if (!amount || amount <= 0 || amount > 500) {
                alert('a cantidade debe ser entre 0.01€ e 500€.');
                return;
            }
            
            if (currentBizumAction === 'send' && amount > currentBalance) {
                alert('Saldo insuficiente para o Bizum. Non seas Chapante');
                return;
            }
            
            // Mostrar 2FA antes de proceder
            show2FAModal('bizum', { phone, amount, concept, action: currentBizumAction });
        }
        
        // Función principal para intentar hacer login
        function attemptLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('login-error');
            
            const correctUsername = 'aitor.tilla';
            const correctPassword = 'Cuntis123';
            
            if (username === correctUsername && password === correctPassword) {
                errorElement.style.display = 'none';
                
                // Seleccionar nombre aleatorio
                currentUser = randomNames[Math.floor(Math.random() * randomNames.length)];
                document.getElementById('welcome-message').textContent = `¡Hola, ${currentUser}!`;
                
                showScreen('home');
            } else {
                errorElement.style.display = 'block';
                errorElement.textContent = 'Usuario ou contrasinal incorrectos';
                
                const loginForm = document.querySelector('.login-form');
                loginForm.classList.add('shake');
                setTimeout(() => {
                    loginForm.classList.remove('shake');
                }, 500);
                
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
            }
        }
        
        // Función para cerrar sesión
        function logout() {
            if (confirm('¿Estás seguro de que queres pechar sesión?')) {
                // Limpiar datos de sesión
                currentUser = '';
                currentBalance = 2540.75;
                virtualCards = [];
                
                // Resetear formularios
                document.getElementById('username').value = 'aitor.tilla';
                document.getElementById('password').value = '';
                
                showScreen('login');
            }
        }
        
        // Función para mostrar/ocultar opciones de transferencia
        function toggleTransferOptions() {
            const transferType = document.getElementById('transfer-type').value;
            const scheduledOptions = document.getElementById('scheduled-options');
            const recurringOptions = document.getElementById('recurring-options');
            const btnText = document.getElementById('transfer-btn-text');
            
            scheduledOptions.style.display = 'none';
            recurringOptions.style.display = 'none';
            
            switch(transferType) {
                case 'scheduled':
                    scheduledOptions.style.display = 'block';
                    btnText.textContent = 'Programar Transferencia';
                    break;
                case 'recurring':
                    recurringOptions.style.display = 'block';
                    btnText.textContent = 'Crear Transferencia Periódica';
                    break;
                default:
                    btnText.textContent = 'Enviar Transferencia';
            }
        }
        
        // Función para actualizar la hora en tiempo real
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            document.getElementById('current-time').textContent = timeString;
        }
        
        // Inicialización cuando el DOM está listo
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            
            // Agregar event listeners para los toggles
            const toggles = document.querySelectorAll('.toggle-switch input[type="checkbox"]');
            toggles.forEach(toggle => {
                toggle.addEventListener('change', function() {
                    // Efecto visual al cambiar
                    const slider = this.nextElementSibling;
                    slider.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        slider.style.transform = 'scale(1)';
                    }, 150);
                });
            });
            
            // También permitir hacer clic en el label para activar el toggle
            const operationLabels = document.querySelectorAll('.operation-toggle label');
            operationLabels.forEach(label => {
                label.addEventListener('click', function() {
                    const toggle = this.parentElement.querySelector('input[type="checkbox"]');
                    toggle.checked = !toggle.checked;
                    toggle.dispatchEvent(new Event('change'));
                });
            });
        });
        
        // Permitir login con Enter
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !document.getElementById('login').classList.contains('hidden')) {
                attemptLogin();
            }
        });
        
        // Sistema de 2FA
        function generateSMSCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }
        
        function show2FAModal(action, data) {
            current2FACode = generateSMSCode();
            pending2FAAction = action;
            pending2FAData = data;
            
            document.getElementById('generated-code').textContent = current2FACode;
            document.getElementById('code-input').value = '';
            document.getElementById('twofa-modal').classList.add('show');
            
            timeLeft = 60;
            updateCountdown();
            countdownTimer = setInterval(updateCountdown, 1000);
            
            setTimeout(() => {
                document.getElementById('code-input').focus();
            }, 300);
        }
        
        function updateCountdown() {
            document.getElementById('timer').textContent = timeLeft;
            timeLeft--;
            
            if (timeLeft < 0) {
                clearInterval(countdownTimer);
                cancel2FA();
                alert('O código expirou. Por favor, inténtao de novo.');
            }
        }
        
        function hide2FAModal() {
            document.getElementById('twofa-modal').classList.remove('show');
            if (countdownTimer) {
                clearInterval(countdownTimer);
                countdownTimer = null;
            }
        }
        
        function verify2FA() {
            const enteredCode = document.getElementById('code-input').value;
            
            if (enteredCode === current2FACode) {
                hide2FAModal();
                
                if (pending2FAAction === 'transfer') {
                    executeTransfer(pending2FAData);
                } else if (pending2FAAction === 'payment') {
                    executePayment(pending2FAData);
                } else if (pending2FAAction === 'deposit') {
                    executeDeposit(pending2FAData);
                } else if (pending2FAAction === 'bizum') {
                    executeBizum(pending2FAData);
                }
                
                pending2FAAction = null;
                pending2FAData = null;
            } else {
                const codeInput = document.getElementById('code-input');
                codeInput.style.borderColor = '#ef4444';
                codeInput.value = '';
                codeInput.placeholder = 'Código incorrecto';
                
                setTimeout(() => {
                    codeInput.style.borderColor = '#e5e7eb';
                    codeInput.placeholder = 'Introduce o código';
                }, 2000);
            }
        }
        
        function cancel2FA() {
            hide2FAModal();
            pending2FAAction = null;
            pending2FAData = null;
        }
        
        // Permitir verificación con Enter en el modal 2FA
        document.getElementById('code-input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                verify2FA();
            }
        });
        
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.add('hidden'));
            
            const targetScreen = document.getElementById(screenId);
            targetScreen.classList.remove('hidden');
            targetScreen.classList.add('fade-in');
            
            targetScreen.scrollTop = 0;
        }
        
        function updateBalance(amount) {
            currentBalance += amount;
            document.getElementById('balance').textContent = `€${currentBalance.toFixed(2)}`;
        }
        
        function addTransaction(description, amount, type = 'negative') {
            const transactionsList = document.querySelector('.transactions');
            const newTransaction = document.createElement('div');
            newTransaction.className = 'transaction-item fade-in';
            
            const now = new Date();
            const time = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            
            newTransaction.innerHTML = `
                <div class="transaction-info">
                    <h4>${description}</h4>
                    <p>Hoy, ${time}</p>
                </div>
                <div class="transaction-amount ${type}">${amount > 0 ? '+' : ''}€${Math.abs(amount).toFixed(2)}</div>
            `;
            
            const firstTransaction = transactionsList.querySelector('.transaction-item');
            if (firstTransaction) {
                transactionsList.insertBefore(newTransaction, firstTransaction);
            } else {
                transactionsList.appendChild(newTransaction);
            }
        }
        
        function processTransfer() {
            const recipient = document.getElementById('recipient').value;
            const accountNumber = document.getElementById('account-number').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const concept = document.getElementById('concept').value;
            
            if (!recipient || !accountNumber || !amount || amount <= 0) {
                alert('Por favor, completa tódolos campos correctamente.');
                return;
            }
            
            const cleanIBAN = accountNumber.replace(/\s/g, '');
            if (!validateIBAN(cleanIBAN)) {
                alert('O IBAN introducido non é válido. Necesitamos IBAN, non Iván');
                return;
            }
            
            if (amount > currentBalance) {
                alert('Saldo insuficiente para realizar a transferencia. Non seas Chapante');
                return;
            }
            
            show2FAModal('transfer', { recipient, accountNumber, amount, concept });
        }
        
        function executeTransfer(data) {
            setTimeout(() => {
                updateBalance(-data.amount);
                addTransaction(`Transferencia a ${data.recipient}`, -data.amount, 'negative');
                
                document.getElementById('transfer-success').style.display = 'block';
                
                document.getElementById('recipient').value = '';
                document.getElementById('account-number').value = '';
                document.getElementById('amount').value = '';
                document.getElementById('concept').value = '';
                
                setTimeout(() => {
                    document.getElementById('transfer-success').style.display = 'none';
                }, 3000);
            }, 1000);
        }
        
        function processPayment() {
            const paymentType = document.getElementById('payment-type').value;
            const reference = document.getElementById('reference').value;
            const amount = parseFloat(document.getElementById('pay-amount').value);
            
            if (!reference || !amount || amount <= 0) {
                alert('Por favor, completa tódolos campos correctamente.');
                return;
            }
            
            if (amount > currentBalance) {
                alert('Saldo insuficiente para realizar o pagamento. Non seas Chapante');
                return;
            }
            
            show2FAModal('payment', { paymentType, reference, amount });
        }
        
        function executePayment(data) {
            setTimeout(() => {
                updateBalance(-data.amount);
                addTransaction(data.paymentType, -data.amount, 'negative');
                
                document.getElementById('pay-success').style.display = 'block';
                
                document.getElementById('reference').value = '';
                document.getElementById('pay-amount').value = '';
                
                setTimeout(() => {
                    document.getElementById('pay-success').style.display = 'none';
                }, 3000);
            }, 1000);
        }
        
        function processDeposit() {
            const depositType = document.getElementById('deposit-type').value;
            const amount = parseFloat(document.getElementById('deposit-amount').value);
            const description = document.getElementById('deposit-desc').value;
            
            if (!amount || amount <= 0 || !description) {
                alert('Por favor, completa tódolos campos correctamente.');
                return;
            }
            
            show2FAModal('deposit', { depositType, amount, description });
        }
        
        function executeDeposit(data) {
            setTimeout(() => {
                updateBalance(data.amount);
                addTransaction(data.description, data.amount, 'positive');
                
                document.getElementById('deposit-success').style.display = 'block';
                
                document.getElementById('deposit-amount').value = '';
                document.getElementById('deposit-desc').value = '';
                
                setTimeout(() => {
                    document.getElementById('deposit-success').style.display = 'none';
                }, 3000);
            }, 1000);
        }
        
        function executeBizum(data) {
            setTimeout(() => {
                let transactionDesc = '';
                let transactionAmount = 0;
                
                if (data.action === 'send') {
                    updateBalance(-data.amount);
                    transactionDesc = `Bizum enviado a ${data.phone}`;
                    transactionAmount = -data.amount;
                } else {
                    updateBalance(data.amount);
                    transactionDesc = `Bizum recibido de ${data.phone}`;
                    transactionAmount = data.amount;
                }
                
                addTransaction(transactionDesc, transactionAmount, data.action === 'send' ? 'negative' : 'positive');
                
                document.getElementById('bizum-success').style.display = 'block';
                
                cancelBizum();
                
                setTimeout(() => {
                    document.getElementById('bizum-success').style.display = 'none';
                }, 3000);
            }, 1000);
        }
        
        function downloadStatement() {
            const link = document.createElement('a');
            link.href = 'data:text/plain;charset=utf-8,EXTRACTO BANCARIO - BanCuntis\n\nTitular: Aitor Tilla\nConta: ES91 2100 0418 4502 0005 1332\nSaldo actual: €' + currentBalance.toFixed(2) + '\n\nGracias por confiar en BanCuntis e na Aula CeMIT';
            link.download = 'extracto-bancario-BanCuntis.txt';
            link.click();
        }
        
        // Agregar eventos de teclado para mejor UX
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('login').classList.contains('hidden')) {
                showScreen('home');
            }
        });
    </script>
</body>
</html>